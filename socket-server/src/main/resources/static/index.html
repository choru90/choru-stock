<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Live Stock Ticks</title>
    <style>/* 생략: 기존 스타일 그대로 */</style>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
</head>
<body>
<h1>Live Stock Ticks</h1>
<table id="tick-table">
    <thead>
    <tr>
        <th>Symbol</th>
        <th>Price</th>
        <th>Timestamp</th>
        <th>Volume</th>
    </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const tbody = document.querySelector('#tick-table tbody');
    const sockJsClient = new SockJS('/ws');
    const stompClient = Stomp.over(sockJsClient);
    const symbols = ['AAPL', 'GOOG'];

    stompClient.connect({}, frame => {
        console.log('STOMP connected:', frame);
        symbols.forEach(symbol => {
            stompClient.subscribe(`/topic/ticks/${symbol}`, message => {
                try {
                    console.log('값', message);
                    const tick = JSON.parse(message.body);
                    addRow(tick);
                } catch (e) {
                    console.warn('메시지 처리 실패', e);
                }
            });
        });
    }, error => {
        console.error('STOMP connection error:', error);
    });

    function addRow(tick) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${tick.symbol}</td>
            <td>${tick.price}</td>
            <td>${new Date(tick.timestamp).toLocaleString()}</td>
            <td>${tick.volume}</td>`;
        tbody.prepend(row);
        if (tbody.rows.length > 50) {
            tbody.removeChild(tbody.lastChild);
        }
    }
</script>
</body>
</html>